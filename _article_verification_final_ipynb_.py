# -*- coding: utf-8 -*-
""""article_verification_final.ipynb"

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1SQlwvJGBcLqC6D54tHcftMJv1xcOc5Ze

# **–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —Å—Ç–∞—Ç—å—é –∏ ‚Äî –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –µ—ë.**
"""

!pip install newspaper3k

!pip install lxml nltk

import nltk
nltk.download('punkt')

!pip install lxml_html_clean

!pip install pymupdf

!pip install pymorphy2

!pip install pdfminer.six

!pip install newspaper3k ipywidgets tabulate --quiet

!pip install pan

import inspect

# –ü–∞—Ç—á–∏–º inspect.getargspec , —á—Ç–æ–±—ã –æ–Ω —Ä–∞–±–æ—Ç–∞–ª —á–µ—Ä–µ–∑ getfullargspec.
def getargspec(func):
    spec = inspect.getfullargspec(func)
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º 4-–∫—É , –∫–∞–∫ getargspec ( args , varargs , keywords , defaults ).
    return spec.args, spec.varargs, spec.varkw, spec.defaults

inspect.getargspec = getargspec  # –ó–∞–º–µ–Ω—è–µ–º –≤ –º–æ–¥—É–ª–µ inspect.

import pymorphy2

morph = pymorphy2.MorphAnalyzer()
print("MorphAnalyzer —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ")

import requests
import ipywidgets as widgets
import re
import pymorphy2
import io
import matplotlib.pyplot as plt
import pandas as pd
from pdfminer.high_level import extract_text_to_fp
from pdfminer.layout import LAParams
from IPython.display import display, clear_output
from urllib.parse import urlparse
from newspaper import Article
from collections import Counter
from tabulate import tabulate
import fitz  # PyMuPDF
import matplotlib.colors as mcolors
import numpy as np

morph = pymorphy2.MorphAnalyzer()

# –î–æ–±–∞–≤–∏–º –º–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É —á–µ—Ä–µ–∑ pymorphy2 –∏ —Å–¥–µ–ª–∞–µ–º , —á—Ç–æ–±—ã –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —É—á–∏—Ç—ã–≤–∞–ª–∞ –≤—Å–µ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å–ª–æ–≤ ( –ª–µ–º–º—ã ) , –∞ –Ω–µ —Ç–æ–ª—å–∫–æ —Ç–æ—á–Ω—ã–µ —Å–ª–æ–≤–∞ –∏–∑ —Å–ø–∏—Å–∫–∞.

# –õ–µ–º–º–∞—Ç–∏–∑–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –æ–¥–∏–Ω —Ä–∞–∑.
'''
–°–∫–ª–æ–Ω–µ–Ω–∏—è ( –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç ‚Üí –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç–∞ , –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç—É... )
–°–∏–Ω–æ–Ω–∏–º—ã ( –≤—Ä–∞—á ‚Üí –¥–æ–∫—Ç–æ—Ä )
–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ –±–ª–∏–∑–∫–∏–µ —Å–ª–æ–≤–∞ ( –≥—Ä–∏–ø–ø ‚Üí –û–†–í–ò , –≤–∞–∫—Ü–∏–Ω–∞ ‚Üí –ø—Ä–∏–≤–∏–≤–∫–∞ )
–§–æ—Ä–º—ã —Å–ª–æ–≤ ( –Ω–∞–ø—Ä–∏–º–µ—Ä , –∏–Ω—Ñ–ª—è—Ü–∏—è ‚Üí –∏–Ω—Ñ–ª—è—Ü–∏–æ–Ω–Ω—ã–π )
'''
def lemmatize_word(word):
    return morph.parse(word)[0].normal_form

def lemmatize_list(words):
    return set(lemmatize_word(w) for w in words)

# –°–ª–æ–≤–∞—Ä—å —Ç–µ–º–∞—Ç–∏–∫.
CATEGORY_KEYWORDS = {
        "–ü–æ–ª–∏—Ç–∏–∫–∞": [
            "–ø—Ä–µ–∑–∏–¥–µ–Ω—Ç", "–ø—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ", "–≤—ã–±–æ—Ä—ã", "–≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ", "–ø–∞—Ä–ª–∞–º–µ–Ω—Ç",
            "–º–∏–Ω–∏—Å—Ç—Ä", "–æ–ø–ø–æ–∑–∏—Ü–∏—è", "–∑–∞–∫–æ–Ω", "—Å–∞–Ω–∫—Ü–∏–∏", "–¥–µ–±–∞—Ç—ã", "–≤–ª–∞—Å—Ç—å",
            "–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ", "–¥–∏–ø–ª–æ–º–∞—Ç–∏—è", "–∏–º–ø–∏—á–º–µ–Ω—Ç", "–ª–æ–±–±–∏", "–∫–æ—Ä—Ä—É–ø—Ü–∏—è"
        ],
        "–≠–∫–æ–Ω–æ–º–∏–∫–∞": [
            "—ç–∫–æ–Ω–æ–º–∏–∫–∞", "—Ä—ã–Ω–æ–∫", "–∏–Ω—Ñ–ª—è—Ü–∏—è", "–±–∏—Ä–∂–∞", "–∞–∫—Ü–∏–∏", "–∫—Ä–∏–∑–∏—Å",
            "–±—é–¥–∂–µ—Ç", "–Ω–∞–ª–æ–≥", "–≤–∞–ª—é—Ç–∞", "–¥–æ–ª–ª–∞—Ä", "–µ–≤—Ä–æ", "–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏",
            "–±–µ–∑—Ä–∞–±–æ—Ç–∏—Ü–∞", "–í–í–ü", "—Ä–µ—Ü–µ—Å—Å–∏—è", "–±–∞–Ω–∫", "–∫—Ä–µ–¥–∏—Ç", "—Ñ–∏–Ω–∞–Ω—Å—ã"
        ],
        "–ù–∞—É–∫–∞ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏": [
            "–Ω–∞—É–∫–∞", "—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ", "–æ—Ç–∫—Ä—ã—Ç–∏–µ", "–∫–æ—Å–º–æ—Å",
            "–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç", "—Ä–æ–±–æ—Ç", "–∫–≤–∞–Ω—Ç–æ–≤—ã–π", "–≥–µ–Ω–µ—Ç–∏–∫–∞",
            "–±–∏–æ—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "–∞—Å—Ç—Ä–æ–Ω–æ–º–∏—è", "—Ñ–∏–∑–∏–∫–∞", "—Ö–∏–º–∏—è", "–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
            "–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ", "–≥–∞–¥–∂–µ—Ç", "—Å—Ç–∞—Ä—Ç–∞–ø", "–∏–Ω–Ω–æ–≤–∞—Ü–∏–∏"
        ],
        "–ú–µ–¥–∏—Ü–∏–Ω–∞": [
            "–º–µ–¥–∏—Ü–∏–Ω–∞", "–∑–¥–æ—Ä–æ–≤—å–µ", "–≤–∏—Ä—É—Å", "–≤–∞–∫—Ü–∏–Ω–∞", "–ø–∞–Ω–¥–µ–º–∏—è",
            "–±–æ–ª—å–Ω–∏—Ü–∞", "–≤—Ä–∞—á", "–ª–µ–∫–∞—Ä—Å—Ç–≤–æ", "–¥–∏–∞–≥–Ω–æ–∑", "–∏–º–º—É–Ω–∏—Ç–µ—Ç",
            "—ç–ø–∏–¥–µ–º–∏—è", "COVID", "–≥—Ä–∏–ø–ø", "—Ç–µ—Ä–∞–ø–∏—è", "—Ö–∏—Ä—É—Ä–≥–∏—è", "–∞–Ω–∞–ª–∏–∑"
        ],
        "–°–ø–æ—Ä—Ç": [
            "—Å–ø–æ—Ä—Ç", "—Ñ—É—Ç–±–æ–ª", "–º–∞—Ç—á", "—á–µ–º–ø–∏–æ–Ω–∞—Ç", "–æ–ª–∏–º–ø–∏–∞–¥–∞", "–∏–≥—Ä–æ–∫",
            "—Ç—Ä–µ–Ω–µ—Ä", "–≥–æ–ª", "—Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ", "—Ç–µ–Ω–Ω–∏—Å", "–±–∞—Å–∫–µ—Ç–±–æ–ª",
            "—Ö–æ–∫–∫–µ–π", "–ø–ª–∞–≤–∞–Ω–∏–µ", "–ª–µ–≥–∫–∞—è –∞—Ç–ª–µ—Ç–∏–∫–∞", "–º–µ–¥–∞–ª—å", "—Ä–µ–∫–æ—Ä–¥"
        ],
        "–ö—É–ª—å—Ç—É—Ä–∞ –∏ –∏—Å–∫—É—Å—Å—Ç–≤–æ": [
            "–∫—É–ª—å—Ç—É—Ä–∞", "–∏—Å–∫—É—Å—Å—Ç–≤–æ", "–∫–∏–Ω–æ", "–º—É–∑–µ–π", "–≤—ã—Å—Ç–∞–≤–∫–∞", "–∫–æ–Ω—Ü–µ—Ä—Ç",
            "–º—É–∑—ã–∫–∞", "–ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞", "–ø–∏—Å–∞—Ç–µ–ª—å", "—Ö—É–¥–æ–∂–Ω–∏–∫", "—Ç–µ–∞—Ç—Ä",
            "–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞", "—Å–∫—É–ª—å–ø—Ç—É—Ä–∞", "–æ–ø–µ—Ä–∞", "–±–∞–ª–µ—Ç", "—Ñ–µ—Å—Ç–∏–≤–∞–ª—å"
        ],
        "–ö—Ä–∏–º–∏–Ω–∞–ª": [
            "–ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏–µ", "—É–±–∏–π—Å—Ç–≤–æ", "–∫—Ä–∞–∂–∞", "–∞—Ä–µ—Å—Ç", "—Å—É–¥", "–ø–æ–ª–∏—Ü–∏—è",
            "–∑–∞–ª–æ–∂–Ω–∏–∫", "—Ç–µ—Ä—Ä–æ—Ä–∏–∑–º", "–Ω–∞—Ä–∫–æ—Ç–∏–∫–∏", "–∫–æ–Ω—Ç—Ä–∞–±–∞–Ω–¥–∞", "–º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ",
            "—Ä–∞–∑–±–æ–π", "–≤—ã–º–æ–≥–∞—Ç–µ–ª—å—Å—Ç–≤–æ", "–ø–æ–±–µ–≥", "—Ä–æ–∑—ã—Å–∫", "—Å–ª–µ–¥—Å—Ç–≤–∏–µ"
        ],
        "–ü—Ä–∏—Ä–æ–¥–∞ –∏ —ç–∫–æ–ª–æ–≥–∏—è": [
            "—ç–∫–æ–ª–æ–≥–∏—è", "–ø—Ä–∏—Ä–æ–¥–∞", "–∫–ª–∏–º–∞—Ç", "–≥–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–µ", "–∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–µ",
            "–ª–µ—Å", "–∂–∏–≤–æ—Ç–Ω—ã–µ", "–∑–∞–ø–æ–≤–µ–¥–Ω–∏–∫", "–∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞", "–Ω–∞–≤–æ–¥–Ω–µ–Ω–∏–µ",
            "–∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–µ", "—É—Ä–∞–≥–∞–Ω", "–≤—ã–º–∏—Ä–∞–Ω–∏–µ", "–æ–∑–æ–Ω", "–ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞", "—ç–∫–æ"
        ],
        "–ê–≤—Ç–æ": [
            "–∞–≤—Ç–æ–º–æ–±–∏–ª—å", "–º–∞—à–∏–Ω–∞", "–¥–≤–∏–≥–∞—Ç–µ–ª—å", "–¥–æ—Ä–æ–≥–∞", "–î–¢–ü", "–≥–∏–±—Ä–∏–¥",
            "—ç–ª–µ–∫—Ç—Ä–æ–º–æ–±–∏–ª—å", "–±–µ–Ω–∑–∏–Ω", "—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞", "–ø—Ä–æ–±–∫–∞", "—Ä–∞–ª–ª–∏",
            "–∞–≤—Ç–æ–≥–æ–Ω–∫–∏", "—Ç—é–Ω–∏–Ω–≥", "–∫—É–∑–æ–≤", "—à–∏–Ω—ã", "—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç"
        ],
        "IT –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã": [
            "–∫–æ–º–ø—å—é—Ç–µ—Ä", "—Å–º–∞—Ä—Ç—Ñ–æ–Ω", "–ø—Ä–æ–≥—Ä–∞–º–º–∞", "—Å–æ—Ñ—Ç", "–∂–µ–ª–µ–∑–æ", "–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä",
            "–≤–∏–¥–µ–æ–∫–∞—Ä—Ç–∞", "–∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å", "—Ö–∞–∫–µ—Ä", "–≤–∏—Ä—É—Å", "—Å–µ—Ç—å",
            "–∏–Ω—Ç–µ—Ä–Ω–µ—Ç", "Wi-Fi", "–∏–≥—Ä–∞", "—Å—Ç—Ä–∏–º–∏–Ω–≥", "–∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞", "–±–ª–æ–∫—á–µ–π–Ω"
        ],
        "–ö–æ—Å–º–æ—Å": [
            "–∫–æ—Å–º–æ—Å", "–ø–ª–∞–Ω–µ—Ç–∞", "–ø–ª–∞–Ω–µ—Ç—ã", "—Å–ø—É—Ç–Ω–∏–∫", "—Å–ø—É—Ç–Ω–∏–∫–∏", "–∑–≤–µ–∑–¥–∞", "–≥–∞–ª–∞–∫—Ç–∏–∫–∞",
            "–≤—Å–µ–ª–µ–Ω–Ω–∞—è", "–∞—Å—Ç–µ—Ä–æ–∏–¥", "–∫–æ–º–µ—Ç–∞", "–æ—Ä–±–∏—Ç–∞", "–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∫–æ—Å–º–æ—Å–∞",
            "—Ç–µ–ª–µ—Å–∫–æ–ø", "–Ω–∞—Å–∞", "—Ä–æ—Å–∫–æ—Å–º–æ—Å", "–∫–æ—Å–º–∏—á–µ—Å–∫–∏–π", "—ç–∫–∑–æ–ø–ª–∞–Ω–µ—Ç–∞", "–∫–æ—Å–º–æ–Ω–∞–≤—Ç",
            "–º–∏—Å—Å–∏—è", "–º–∞—Ä—Å", "–ª—É–Ω–∞", "–≤–µ–Ω–µ—Ä–∞", "—é–ø–∏—Ç–µ—Ä", "–º–ª–µ—á–Ω—ã–π –ø—É—Ç—å"
        ],
        "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞": [
            "–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "—É—Ä–∞–≤–Ω–µ–Ω–∏–µ", "—Ñ–æ—Ä–º—É–ª–∞", "—Ñ—É–Ω–∫—Ü–∏—è", "–∏–Ω—Ç–µ–≥—Ä–∞–ª", "–ø—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è",
            "–ª–æ–≥–∞—Ä–∏—Ñ–º", "–∫–æ–ª–µ–±–∞–Ω–∏–π", "–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ", "–∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞", "–∞–ª–≥–µ–±—Ä–∞",
            "–≥–µ–æ–º–µ—Ç—Ä–∏—è", "—Ç—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è", "–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å", "—Ç–µ–æ—Ä–µ–º–∞",
            "—á–∏—Å–ª–æ", "–≥—Ä–∞—Ñ–∏–∫", "–≤–µ–∫—Ç–æ—Ä", "–º–∞—Ç—Ä–∏—Ü–∞", "—Ä–µ—à–µ–Ω–∏–µ", "–¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ",
            "–ª–æ–≥–∏–∫–∞", "–∞–Ω–∞–ª–∏–∑", "–ø–æ–ª–∏–Ω–æ–º", "—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å"
        ],
        "–ï–¥–∞ –∏ –∫—É–ª–∏–Ω–∞—Ä–∏—è" : [
            "–∫—É–ª–∏–Ω–∞—Ä–∏—è", "—Ä–µ—Ü–µ–ø—Ç", "–±–ª—é–¥–æ", "–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã", "—à–µ—Ñ-–ø–æ–≤–∞—Ä", "—Ä–µ—Å—Ç–æ—Ä–∞–Ω",
            "–º–µ–Ω—é", "–¥–∏–µ—Ç–∞", "–≤–µ–≥–∞–Ω", "–≥—É—Ä–º–∞–Ω", "—Ñ–∞—Å—Ç—Ñ—É–¥", "–ø–∏—Ü—Ü–∞", "—Å—É—à–∏", "–Ω–∞–ø–∏—Ç–∫–∏",
            "–∫–æ—Ñ–µ", "—á–∞–π", "–¥–µ—Å–µ—Ä—Ç", "–≥—Ä–∏–ª—å", "–≤–∏–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞"
        ],
        "–ò—Å—Ç–æ—Ä–∏—è" : [
            "–∏—Å—Ç–æ—Ä–∏—è", "–∞—Ä—Ö–µ–æ–ª–æ–≥–∏—è", "–¥—Ä–µ–≤–Ω–∏–π –º–∏—Ä", "—Å—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—å–µ", "—Ä–µ–≤–æ–ª—é—Ü–∏—è",
            "–≤–µ–ª–∏–∫–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏", "–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è", "–∫—É–ª—å—Ç—É—Ä–∞ –Ω–∞—Ä–æ–¥–æ–≤",
            "–≤–æ–π–Ω—ã", "–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏", "–º–æ–Ω–∞—Ä—Ö–∏—è", "–∫–æ–ª–æ–Ω–∏–∑–∞—Ü–∏—è", "–¥—Ä–µ–≤–Ω–µ–µ"
        ],
        "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç": [
            "–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç", "–Ω–µ–π—Ä–æ—Å–µ—Ç—å", "–Ω–µ–π—Ä–æ—Å–µ—Ç–∏", "–º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ",
            "–æ–±—É—á–µ–Ω–∏–µ —Å –ø–æ–¥–∫—Ä–µ–ø–ª–µ–Ω–∏–µ–º", "–Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–µ—Ç–∏", "–ò–ò", "GPT", "–≥–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω–∞—è –º–æ–¥–µ–ª—å",
            "–æ–±—Ä–∞–±–æ—Ç–∫–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞", "–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–∞–∑—É–º"
        ],
        "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ": [
            "–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", "—à–∫–æ–ª–∞", "—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç", "–∫–æ–ª–ª–µ–¥–∂", "—É—á–µ–±–∞", "—Å—Ç—É–¥–µ–Ω—Ç", "–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å", "—É—á–∏—Ç–µ–ª—å", "–¥–∏–ø–ª–æ–º", "—ç–∫–∑–∞–º–µ–Ω", "—Ç–µ—Å—Ç", "–∫—É—Ä—Å", "–ª–µ–∫—Ü–∏—è", "—Å–µ–º–∏–Ω–∞—Ä", "–¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ", "–æ–Ω–ª–∞–π–Ω-–∫—É—Ä—Å", "—Å—Ç–∏–ø–µ–Ω–¥–∏—è", "–≥—Ä–∞–Ω—Ç", "–∞–∫–∞–¥–µ–º–∏—è", "–ø–µ–¥–∞–≥–æ–≥–∏–∫–∞", "—É—á–µ–±–Ω–∏–∫", "–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞", "—Ñ–∞–∫—É–ª—å—Ç–µ—Ç", "—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å"
        ],
        "–í–∏–¥–µ–æ–∏–≥—Ä—ã": [
            "–∏–≥—Ä—ã", "–≥–µ–π–º–µ—Ä", "–∫–æ–Ω—Å–æ–ª—å", "PlayStation", "Xbox", "Nintendo", "–ü–ö", "—Å—Ç—Ä–∏–º–∏–Ω–≥", "–∫–∏–±–µ—Ä—Å–ø–æ—Ä—Ç", "DLC", "–º–æ–¥", "–æ—Ç–∫—Ä—ã—Ç—ã–π –º–∏—Ä", "RPG", "—à—É—Ç–µ—Ä", "—Å—Ç—Ä–∞—Ç–µ–≥–∏—è", "–∏–Ω–¥–∏-–∏–≥—Ä—ã", "–≥—Ä–∞—Ñ–∏–∫–∞", "–≥–µ–π–º–ø–ª–µ–π", "–ø–∞—Ç—á", "—Ä–∞–Ω–Ω–µ—Ä"
        ]
    }

# –õ–µ–º–º–∞—Ç–∏–∑–∏—Ä—É–µ–º –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –æ–¥–∏–Ω —Ä–∞–∑.
CATEGORY_KEYWORDS_LEMMAS = {
    cat: set(lemmatize_word(word) for word in words)
    for cat, words in CATEGORY_KEYWORDS.items()
}

# –î–ª—è —Ä–∞–±–æ—Ç—ã —Å PDF —Å—Å—ã–ª–∫–∞–º–∏.
def extract_text_from_pdf(url):
    try:
        HEADERS = {
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) "
                          "AppleWebKit/537.36 (KHTML, like Gecko) "
                          "Chrome/114.0.0.0 Safari/537.36",
            "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
            "Accept-Language": "ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7",
        }
        response = requests.get(url, headers=HEADERS)
        response.raise_for_status()
        output_string = io.StringIO()
        with io.BytesIO(response.content) as pdf_file:
            extract_text_to_fp(pdf_file, output_string, laparams=LAParams(), output_type='text', codec=None)
        return output_string.getvalue()
    except Exception as e:
        return None

def evaluate_text(text):
    # –°–æ–∑–¥–∞–µ–º —Ñ–µ–π–∫–æ–≤—ã–π –æ–±—ä–µ–∫—Ç article –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤ evaluate_article.
    class DummyArticle:
        def __init__(self, text):
            self.text = text
            self.title = text[:50]
            self.authors = []
    dummy = DummyArticle(text)
    return evaluate_article(dummy)

def analyze_article(url):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å—Å—ã–ª–∫–∏.
    # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è requests.head() –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞.
    # –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç ( –Ω–µ 200 OK ) , —Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Å–æ–æ–±—â–∞–µ—Ç –æ–± –æ—à–∏–±–∫–µ.
    try:
        HEADERS = {
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) "
                          "AppleWebKit/537.36 (KHTML, like Gecko) "
                          "Chrome/114.0.0.0 Safari/537.36",
            "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
            "Accept-Language": "ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7",
        }
        response = requests.head(url, headers=HEADERS, allow_redirects=True)
        #response = requests.head(url, allow_redirects=True)
        if response.status_code != 200:
            return {
                "error": f"–°—Ç–∞—Ç—å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ö–æ–¥ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞: {response.status_code}",
                "response_text": response.text if hasattr(response, 'text') else ''
            }
    except requests.exceptions.RequestException as e:
        return {"error": f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ —Å–µ—Ä–≤–µ—Ä—É: {str(e)}"}

    # –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ PDF.
    if url.lower().endswith('.pdf'):
        text = extract_text_from_pdf(url)
        if not text or len(text) < 100:
            return {"error": "–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ PDF –∏–ª–∏ —Ç–µ–∫—Å—Ç —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π"}
        # –î–ª—è PDF - –∑–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–∂–Ω–æ –ø—É—Å—Ç—ã–º –∏–ª–∏ –≤–∑—è—Ç—å –ø–µ—Ä–≤—ã–µ 100 —Å–∏–º–≤–æ–ª–æ–≤.
        title = text[:100].replace('\n', ' ') + "..."
        source_type = "PDF –¥–æ–∫—É–º–µ–Ω—Ç"
        categories = classify_text_weighted(text)
        categories_with_percent = classify_text_weighted(text)
        score = evaluate_text(text)
        return {
            "url": url,
            "title": title,
            "source": urlparse(url).netloc,
            "source_type": source_type,
            "categories": categories_with_percent[:3] if len(categories_with_percent) > 3 else categories_with_percent,
            "score": score,
        }

    # –ï—Å–ª–∏ —ç—Ç–æ —Å–∞–π—Ç ‚Äî –ø—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å PDF –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
    # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥ —Å—Ç–∞—Ç—å–∏.
    # –° –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ newspaper3k –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞.
    # –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫ , –∞–≤—Ç–æ—Ä , —Ç–µ–∫—Å—Ç.
    article = Article(url)
    article.download()
    article.parse()

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ PDF —Å—Å—ã–ª–æ–∫ –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
    pdf_links = re.findall(r'href=["\']([^"\']+\.pdf)["\']', article.html, re.IGNORECASE)
    if pdf_links:
        # –ë–µ—Ä–µ–º –ø–µ—Ä–≤—É—é PDF —Å—Å—ã–ª–∫—É , –¥–æ–±–∞–≤–ª—è–µ–º –∫ –±–∞–∑–æ–≤–æ–º—É URL , –µ—Å–ª–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è.
        pdf_url = pdf_links[0]
        if not pdf_url.startswith('http'):
            base_url = '{uri.scheme}://{uri.netloc}'.format(uri=urlparse(url))
            pdf_url = base_url + pdf_url if pdf_url.startswith('/') else base_url + '/' + pdf_url

        text = extract_text_from_pdf(pdf_url)
        if not text or len(text) < 100:
            return {"error": "–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ PDF –∏–ª–∏ —Ç–µ–∫—Å—Ç —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π"}
        title = text[:100].replace('\n', ' ') + "..."
        source_type = "PDF –¥–æ–∫—É–º–µ–Ω—Ç (—Å —Å–∞–π—Ç–∞)"
        categories = classify_text_weighted(text)
        categories_with_percent = classify_text_weighted(text)
        score = evaluate_text(text)
        return {
            "url": pdf_url,
            "title": title,
            "source": urlparse(pdf_url).netloc,
            "source_type": source_type,
            "categories": categories_with_percent[:3] if len(categories_with_percent) > 3 else categories_with_percent,
            "score": score,
        }

    # –ï—Å–ª–∏ PDF –Ω–µ –Ω–∞–π–¥–µ–Ω , –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—ã—á–Ω—É—é —Å—Ç–∞—Ç—å—é.
    # –ü—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç–∞ –º–∞–ª–æ ( <100 —Å–∏–º–≤–æ–ª–æ–≤ ) ‚Äî —ç—Ç–æ –Ω–µ —Å—Ç–∞—Ç—å—è –∏–ª–∏ –Ω–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è.
    if not article.text or len(article.text) < 100:
        return {"error": "–≠—Ç–æ –Ω–µ —Å—Ç–∞—Ç—å—è –∏–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π"}

    # –ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞.
    # –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –¥–æ–º–µ–Ω.
      # –ù–∞–ø—Ä–∏–º–µ—Ä , bbc.com.
    # –§—É–Ω–∫—Ü–∏—è classify_source() —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–≥–æ —Å –±–∞–∑–æ–π –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤.
      # –ù–∞–ø—Ä–∏–º–µ—Ä: bbc.com ‚Üí –ù–æ–≤–æ—Å—Ç–∏ , arxiv.org ‚Üí –ù–∞—É—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏.
    domain = urlparse(url).netloc
    source_type = classify_source(domain)
    categories = classify_text_weighted(article.text)  # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞.
    score = evaluate_article(article). # –û—Ü–µ–Ω–∫–∞.
    categories_with_percent = classify_text_weighted(article.text)
    return {
        "url": url,
        "title": article.title,
        "source": domain,
        "source_type": source_type,
        # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º , –µ—Å–ª–∏ –∏—Ö –±–æ–ª—å—à–µ 3 , —Ç–æ –≤—ã–≤–æ–¥–∏–º –ø–µ—Ä–≤—ã–µ 3.
        "categories": categories_with_percent[:3] if len(categories_with_percent) > 3 else categories_with_percent,
        "score": score,
    }

def classify_text_weighted(text):
    # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ —Ç–µ–º–∞–º.
    # –°—á–∏—Ç–∞—é—Ç—Å—è –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ —Ç–µ–∫—Å—Ç–µ.
    # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ª–æ–≤–∞—Ä—å —Ç–µ–º–∞—Ç–∏–∫ ( –ü–æ–ª–∏—Ç–∏–∫–∞ , –≠–∫–æ–Ω–æ–º–∏–∫–∞ , –ú–µ–¥–∏—Ü–∏–Ω–∞ –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ ).
    # –í—ã–¥–∞—é—Ç—Å—è –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –ø–æ—Ä—è–¥–∫–µ —É–±—ã–≤–∞–Ω–∏—è –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏.
    text_lower = text.lower()
    words = re.findall(r'\w+', text_lower) # –õ—É—á—à–µ —á–µ—Ä–µ–∑ regex , —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –∑–Ω–∞–∫–∏ –ø—É–Ω–∫—Ç—É–∞—Ü–∏–∏.
    lemmas = [lemmatize_word(w) for w in words]
    word_counts = Counter(lemmas)

    category_scores = {}
    for category, keywords_lemmas in CATEGORY_KEYWORDS_LEMMAS.items():
        score = sum(word_counts.get(keyword, 0) for keyword in keywords_lemmas)
        if score > 0:
            category_scores[category] = score

    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ —É–±—ã–≤–∞–Ω–∏—é.
    sorted_categories = sorted(category_scores.items(), key=lambda x: x[1], reverse=True)

    total_score = sum(category_scores.values()) or 1  # —á—Ç–æ–±—ã –Ω–µ –¥–µ–ª–∏—Ç—å –Ω–∞ 0.

    result = []
    for cat, score in sorted_categories:
        percent = round(score / total_score * 100, 1)
        result.append({"category": cat, "score": score, "percent": percent})

    return result

# –°–ø–∏—Å–æ–∫ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤.
def classify_source(domain):
    known_sources = {
        "bbc.com": "–ù–æ–≤–æ—Å—Ç–∏",
        "elibrary.ru": "–ù–∞—É—á–∞–Ω–∞—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞",
        "znanierussia.ru": "–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è —ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è",
        "cyberleninka.ru": "–ù–∞—É—á–Ω–∞—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞",
        "ru.wikipedia.org": "–í–∏–∫–∏–ø–µ–¥–∏—è",
        "mel.fm": "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏ –≤–æ—Å–ø–∏—Ç–∞–Ω–∏–µ",
        "edutainme.ru": "–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
        "postnauka.ru": "–ù–∞—É—á–Ω–æ-–ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã",
        "stopgame.ru": "–í—Å–µ –ø—Ä–æ –∏–≥—Ä—ã",
        "igromania.ru":"–°—Ç–∞—Ç—å–∏ –∏ –Ω–æ–≤–æ—Å—Ç–∏",
        "arxiv.org": "–ù–∞—É—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏",
        "ria.ru": "–ù–æ–≤–æ—Å—Ç–∏",
        "tass.ru": "–ù–æ–≤–æ—Å—Ç–∏",
        "lenta.ru": "–ù–æ–≤–æ—Å—Ç–∏",
        "kommersant.ru": "–î–µ–ª–æ–≤—ã–µ –Ω–æ–≤–æ—Å—Ç–∏",
        "vedomosti.ru": "–î–µ–ª–æ–≤—ã–µ –Ω–æ–≤–æ—Å—Ç–∏",
        "rg.ru": "–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏",
        "gazeta.ru": "–ù–æ–≤–æ—Å—Ç–∏",
        "iz.ru": "–ù–æ–≤–æ—Å—Ç–∏",
        "mk.ru": "–ù–æ–≤–æ—Å—Ç–∏",
        "rbc.ru": "–≠–∫–æ–Ω–æ–º–∏–∫–∞ –∏ –±–∏–∑–Ω–µ—Å",
        "novayagazeta.ru": "–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç–∏–∫–∞/–ê–Ω–∞–ª–∏—Ç–∏–∫–∞",
        "vc.ru": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –±–∏–∑–Ω–µ—Å",
        "habr.com": "IT –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
        "nplus1.ru": "–ù–∞—É–∫–∞ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
        "fontanka.ru": "–†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏",
        "echo.msk.ru": "–ú–µ–¥–∏–∞/–ú–Ω–µ–Ω–∏—è",
        "znak.com": "–ù–æ–≤–æ—Å—Ç–∏",
        "www.consultant.ru": "–ü—Ä–∞–≤–æ–≤—ã–µ –∞–∫—Ç—ã –∏ –ö–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏—è –†–§",
        "www.sports.ru": "–ú–∏—Ä —Å–ø–æ—Ä—Ç–∞",
    }
    return known_sources.get(domain, "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫")

# –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å—Ç–∞—Ç—å–∏.
'''
| –ö—Ä–∏—Ç–µ—Ä–∏–π                                       | –ë–∞–ª–ª—ã |
| ---------------------------------------------- | ----- |
| –î–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞ > 1500 —Å–∏–º–≤–æ–ª–æ–≤                   | +2    |
| –ï—Å—Ç—å –∞–≤—Ç–æ—Ä(—ã)                                  | +1    |
| –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç –±–æ–ª–µ–µ 3 —Å–ª–æ–≤                | +1    |
| –ö–∞—Ç–µ–≥–æ—Ä–∏–π –±–æ–ª–µ–µ 1                              | +1    |
| –¢–µ–∫—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ö–æ—Ç—è –±—ã 3 –∞–±–∑–∞—Ü–∞                | +1    |
| –í —Ç–µ–∫—Å—Ç–µ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã 1 –¥–∞—Ç–∞ –∏–ª–∏ —á–∏—Å–ª–æ         | +1    |
| –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤                 | +1    |
| –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–ª—é—á–µ–≤—ã–µ —Ç–µ—Ä–º–∏–Ω—ã –∏–∑ —Ç–æ–ø-5 —Ç–µ–º–∞—Ç–∏–∫ | +2    |
'''
def evaluate_article(article):
    score = 0
    text = article.text.strip()

    # –î–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞.
    if len(text) > 1500:
        score += 2
    elif len(text) > 1000:
        score += 1

    # –ê–≤—Ç–æ—Ä—ã.
    if article.authors:
        score += 1

    # –ó–∞–≥–æ–ª–æ–≤–æ–∫.
    if len(article.title.split()) > 3:
        score += 1

    # –ö–∞—Ç–µ–≥–æ—Ä–∏–π –±–æ–ª—å—à–µ –æ–¥–Ω–æ–π.
    categories = classify_text_weighted(text)
    if len(categories) > 1:
        score += 1

    # –ê–±–∑–∞—Ü—ã.
    if text.count('\n') >= 2:
        score += 1

    # –ï—Å—Ç—å –¥–∞—Ç—ã / —á–∏—Å–ª–∞.
    if re.search(r'\d{4}|\d{1,2}[./-]\d{1,2}', text):
        score += 1

    # –ï—Å—Ç—å —Ä–∞–∑–¥–µ–ª "–ò—Å—Ç–æ—á–Ω–∏–∫–∏" –∏–ª–∏ –ø–æ—Ö–æ–∂–∏–µ.
    if re.search(r'(—Å–ø–∏—Å–æ–∫ –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã|–∏—Å—Ç–æ—á–Ω–∏–∫–∏|–ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞|references|–±–∏–±–ª–∏–æ–≥—Ä–∞—Ñ–∏—è|used sources)', text.lower()):
        score += 1

    # –¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏–∑ —Ç–æ–ø-5.
    word_counts = Counter(text.lower().split())
    category_keywords = CATEGORY_KEYWORDS
    top_themes = list(Counter({
        cat: sum(word_counts.get(k, 0) for k in kws)
        for cat, kws in category_keywords.items()
    }).most_common(5))
    if any(count >= 3 for _, count in top_themes):
        score += 2

    return min(score, 10)

# –î–∞—Ç–∞—Å–µ—Ç —Ä–∞–∑–º–µ—á–µ–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.
test_dataset = [
    {"url": "https://www.rbc.ru/rbcfreenews/684034c29a794788ce2643b1", "true_category": "–ü–æ–ª–∏—Ç–∏–∫–∞"},
    {"url": "https://ru.ruwiki.ru/wiki/%D0%9E%D1%81%D0%B0%D0%B4%D0%B0_%D0%98%D0%B5%D1%80%D1%83%D1%81%D0%B0%D0%BB%D0%B8%D0%BC%D0%B0_(1187)", "true_category": "–ü–æ–ª–∏—Ç–∏–∫–∞"},
    {"url": "https://ru.ruwiki.ru/wiki/%D0%A4%D0%B0%D1%80%D0%B0%D0%BE%D0%BD", "true_category": "–ü–æ–ª–∏—Ç–∏–∫–∞"},
    {"url": "https://habr.com/ru/articles/536446/", "true_category": "–ü–æ–ª–∏—Ç–∏–∫–∞"},
    {"url": "http://www.jurvestnik.psu.ru/images/stories/vestnik/pdf/2009_4_6.pdf", "true_category": "–ü–æ–ª–∏—Ç–∏–∫–∞"},
    {"url": "https://www.bbc.com/russian/articles/c5112xml40eo", "true_category": "–ü–æ–ª–∏—Ç–∏–∫–∞"},

    {"url": "https://myeconomix.ru/finansy/prichiny-neeffektivnosti-sberegatelnykh-sertifikatov/", "true_category": "–≠–∫–æ–Ω–æ–º–∏–∫–∞"},
    {"url": "https://www.rbc.ru/quote/news/article/627e10719a79476d62900ee8", "true_category": "–≠–∫–æ–Ω–æ–º–∏–∫–∞"},
    {"url": "https://research-journal.org/archive/5-155-2025-may/10.60797/IRJ.2025.155.36", "true_category": "–≠–∫–æ–Ω–æ–º–∏–∫–∞"},
    {"url": "https://vaael.ru/article/view?id=3214", "true_category": "–≠–∫–æ–Ω–æ–º–∏–∫–∞"},
    {"url": "http://publishing-vak.ru/file/archive-economy-2015-5/5-prokopchuk.pdf", "true_category": "–≠–∫–æ–Ω–æ–º–∏–∫–∞"},
    {"url": "http://publishing-vak.ru/file/archive-economy-2015-10/4-kabir-yakovlev-nikulina.pdf", "true_category": "–≠–∫–æ–Ω–æ–º–∏–∫–∞"},

    {"url": "https://ria.ru/20250604/tsentry-2020848140.html", "true_category": "–ù–∞—É–∫–∞ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏"},
    {"url": "https://sibac.info/journal/student/317/379439", "true_category": "–ù–∞—É–∫–∞ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏"},
    {"url": "https://research-journal.org/archive/6-156-2025-june/10.60797/IRJ.2025.156.68", "true_category": "–ù–∞—É–∫–∞ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏"},
    {"url": "https://moluch.ru/archive/483/105878/", "true_category": "–ù–∞—É–∫–∞ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏"},
    {"url": "https://sibac.info/journal/student/317/379418", "true_category": "–ù–∞—É–∫–∞ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏"},
    {"url": "https://sibac.info/studconf/science/ccxiv/378908", "true_category": "–ù–∞—É–∫–∞ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏"},

    {"url": "https://medkras.com/articles/vypadenie-volos-alopetsiya/", "true_category": "–ú–µ–¥–∏—Ü–∏–Ω–∞"},
    {"url": "https://cmclinic.ru/statii/chto-takoe-massazh.html", "true_category": "–ú–µ–¥–∏—Ü–∏–Ω–∞"},
    {"url": "https://tekstura.moscow/blog/sportivnyij-massazh-ili-rasslablyayushhij-kak-vyibrat-v-zavisimosti-ot-vashego-obraza-zhizni/", "true_category": "–ú–µ–¥–∏—Ü–∏–Ω–∞"},
    {"url": "https://research-journal.org/archive/5-155-2025-may/10.60797/IRJ.2025.155.73", "true_category": "–ú–µ–¥–∏—Ü–∏–Ω–∞"},
    {"url": "https://www.hse.ru/news/communication/172986695.html", "true_category": "–ú–µ–¥–∏—Ü–∏–Ω–∞"},
    {"url": "https://stvolkletki.ru/mass-media/view.php?media=ob-umnykh-stvolovykh-kletkakh-farmakologicheskom-fashizme-geneticheskikh-portretakh-i-russkom-mental", "true_category": "–ú–µ–¥–∏—Ü–∏–Ω–∞"},

    {"url": "https://www.sports.ru/football/blogs/3327923.html", "true_category": "–°–ø–æ—Ä—Ç"},
    {"url": "https://research-journal.org/archive/6-156-2025-june/10.60797/IRJ.2025.156.62", "true_category": "–°–ø–æ—Ä—Ç"},
    {"url": "https://www.sports.ru/football/blogs/3318250.html", "true_category": "–°–ø–æ—Ä—Ç"},
    {"url": "https://www.championat.com/football/article-6053816-klubnyj-chempionat-mira-2025-obzor-matchej-16-iyunya-chelsi-los-andzheles-palmejras-portu-botafogo-glavnye-sobytiya.html", "true_category": "–°–ø–æ—Ä—Ç"},
    {"url": "https://www.championat.com/cybersport/article-6035658-vse-o-blast-tv-austin-major-2025-uchastniki-format-i-raspisanie-gde-smotret-mejdzhor-po-cs-2.html", "true_category": "–°–ø–æ—Ä—Ç"},
    {"url": "https://www.sports.ru/others/blogs/2847461.html", "true_category": "–°–ø–æ—Ä—Ç"},

    {"url": "https://joseartgallery.com/ru/articles/starting-an-art-collection-on-any-budget", "true_category": "–ö—É–ª—å—Ç—É—Ä–∞ –∏ –∏—Å–∫—É—Å—Å—Ç–≤–æ"},
    {"url": "https://lenta.ru/articles/2025/06/16/gde-kupatsya-v-podmoskovie/", "true_category": "–ö—É–ª—å—Ç—É—Ä–∞ –∏ –∏—Å–∫—É—Å—Å—Ç–≤–æ"},
    {"url": "https://lenta.ru/articles/2025/06/13/labuburu/", "true_category": "–ö—É–ª—å—Ç—É—Ä–∞ –∏ –∏—Å–∫—É—Å—Å—Ç–≤–æ"},
    {"url": "https://veryimportantlot.com/ru/news/obchestvo-i-lyudi/zhivopis-drevnego-egipta-periody-i-glavnye-osobennosti", "true_category": "–ö—É–ª—å—Ç—É—Ä–∞ –∏ –∏—Å–∫—É—Å—Å—Ç–≤–æ"},
    {"url": "https://www.vedomosti.ru/esg/ecology/articles/2025/05/22/1112065-rossiya-vibiraet-ustoichivoe-buduschee", "true_category": "–ö—É–ª—å—Ç—É—Ä–∞ –∏ –∏—Å–∫—É—Å—Å—Ç–≤–æ"},
    {"url": "https://ru.wikipedia.org/wiki/%D0%9F%D0%B8%D0%BA%D0%B0%D1%81%D1%81%D0%BE,_%D0%9F%D0%B0%D0%B1%D0%BB%D0%BE", "true_category": "–ö—É–ª—å—Ç—É—Ä–∞ –∏ –∏—Å–∫—É—Å—Å—Ç–≤–æ"},

    {"url": "https://www.consultant.ru/document/cons_doc_LAW_10699/43b57d6c014e99070854acf76d1627ac9a184239/", "true_category": "–ö—Ä–∏–º–∏–Ω–∞–ª"},
    {"url": "https://www.interfax.ru/russia/1018395", "true_category": "–ö—Ä–∏–º–∏–Ω–∞–ª"},
    {"url": "https://tass.ru/obschestvo/12604591", "true_category": "–ö—Ä–∏–º–∏–Ω–∞–ª"},
    {"url": "https://pravo.ru/story/206434/", "true_category": "–ö—Ä–∏–º–∏–Ω–∞–ª"},
    {"url": "https://pravo.ru/review/view/141562/", "true_category": "–ö—Ä–∏–º–∏–Ω–∞–ª"},
    {"url": "https://rg.ru/2019/10/19/reg-urfo/diavol-vo-ploti-pochemu-samye-zhestokie-prestupleniia-sovershaiut-zhenshchiny.html", "true_category": "–ö—Ä–∏–º–∏–Ω–∞–ª"},

    {"url": "https://moluch.ru/young/archive/17/1226/", "true_category": "–ü—Ä–∏—Ä–æ–¥–∞ –∏ —ç–∫–æ–ª–æ–≥–∏—è"},
    {"url": "https://moluch.ru/young/archive/38/2156/", "true_category": "–ü—Ä–∏—Ä–æ–¥–∞ –∏ —ç–∫–æ–ª–æ–≥–∏—è"},
    {"url": "https://www.nkj.ru/archive/articles/2101/", "true_category": "–ü—Ä–∏—Ä–æ–¥–∞ –∏ —ç–∫–æ–ª–æ–≥–∏—è"},
    {"url": "https://www.nkj.ru/archive/articles/25983/", "true_category": "–ü—Ä–∏—Ä–æ–¥–∞ –∏ —ç–∫–æ–ª–æ–≥–∏—è"},
    {"url": "https://forest-save.ru/esg-blog/kak-pomoch-prirode", "true_category": "–ü—Ä–∏—Ä–æ–¥–∞ –∏ —ç–∫–æ–ª–æ–≥–∏—è"},
    {"url": "https://www.biosfera92.ru/poleznye-stati/problemy-ekologii-v-sovremennom-mire", "true_category": "–ü—Ä–∏—Ä–æ–¥–∞ –∏ —ç–∫–æ–ª–æ–≥–∏—è"},

    {"url": "https://ru.wikipedia.org/wiki/Bugatti", "true_category": "–ê–≤—Ç–æ"},
    {"url": "https://www.nkj.ru/archive/articles/8206/", "true_category": "–ê–≤—Ç–æ"},
    {"url": "https://www.kolesa.ru/article/tormoza-ot-nissan-i-nikakogo-stoka-tiuning-toyota-cresta-gx71-dlia-rds-gp", "true_category": "–ê–≤—Ç–æ"},
    {"url": "https://favorit-motors.ru/articles/vybor-avtomobilya/luchshie-avto-s-probegom/", "true_category": "–ê–≤—Ç–æ"},
    {"url": "https://favorit-motors.ru/articles/sovety-voditelyam/kak-zashchitit-mashinu-esli-net-garazha-layfkhaki-dlya-stoyanki-na-otkrytom-vozdukhe/", "true_category": "–ê–≤—Ç–æ"},
    {"url": "https://favorit-motors.ru/articles/ekspluataciya-avto/kak-zashchitit-lobovoe-steklo-ot-skolov-na-trasse-prostye-layfkhaki/", "true_category": "–ê–≤—Ç–æ"},

    {"url": "https://www.it-world.ru/it-news/7kjetk9f6scg0s0w04s0kwo0kgckg4s.html", "true_category": "IT –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã"},
    {"url": "https://vc.ru/tech/1304025-kompyuternaya-mysh-kak-poyavilsya-i-menyalsya-samyi-nuzhnyi-aksessuar-dlya-pk", "true_category": "IT –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã"},
    {"url": "https://www.it-world.ru/it-news/11dsjh4hkk3k4gksg8og84o8s8okcgw.html", "true_category": "IT –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã"},
    {"url": "https://habr.com/ru/companies/oleg-bunin/articles/511430/", "true_category": "IT –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã"},
    {"url": "https://www.computerra.ru/316619/laboratoriya-kasperskogo-nachinaet-prodazhi-virtualnyh-sim-kart-cherez-kaspersky-esim-store/", "true_category": "IT –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã"},
    {"url": "https://3dnews.ru/1124176/realme-gt-7-dream-edition-review", "true_category": "IT –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã"},

    {"url": "https://iki.cosmos.ru/popular/articles/luna-25-i-drugie-missii-kak-razvivalas-otechestvennaya-lunnaya-programma", "true_category": "–ö–æ—Å–º–æ—Å"},
    {"url": "https://naked-science.ru/article/cosmonautics/kitaj-ozvuchil-datu-starta-lunnoj-missii-chane-6", "true_category": "–ö–æ—Å–º–æ—Å"},
    {"url": "https://sci-article.ru/stat.php?i=1648302071", "true_category": "–ö–æ—Å–º–æ—Å"},
    {"url": "https://iki.cosmos.ru/popular/articles/sedmoy-kontinent-kakie-missii-planiruyutsya-posle-luny-25", "true_category": "–ö–æ—Å–º–æ—Å"},
    {"url": "https://iki.cosmos.ru/popular/articles/klondayk-na-poverkhnosti-luny-voda-kaliforniy-i-geliy", "true_category": "–ö–æ—Å–º–æ—Å"},
    {"url": "https://www.ferra.ru/news/techlife/v-rossii-razrabotali-tekhnologiyu-obsluzhivaniya-kosmicheskoi-stancii-robotami-09-06-2025.htm", "true_category": "–ö–æ—Å–º–æ—Å"},

    {"url": "https://vestnik-rosnou.ru/sites/default/files/26_PDFsam_%D0%A1%D0%BB%D0%BE%D0%B6%D0%BD%D1%8B%D0%B5%20%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B%202.pdf", "true_category": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"},
    {"url": "https://research-journal.org/archive/5-155-2025-may/10.60797/IRJ.2025.155.10", "true_category": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"},
    {"url": "https://research-journal.org/archive/5-155-2025-may/10.60797/IRJ.2025.155.48", "true_category": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"},
    {"url": "https://moluch.ru/young/archive/20/1330/", "true_category": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"},
    {"url": "https://sibac.info/journal/student/313/372371", "true_category": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"},
    {"url": "https://book.etudes.ru/articles/technics/", "true_category": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"},

    {"url": "https://efspb.ru/blog/morozhenoe-vred-i-polza-plombira/", "true_category": "–ï–¥–∞ –∏ –∫—É–ª–∏–Ω–∞—Ä–∏—è"},
    {"url": "https://eda.ru/media/recepty/kak-prigotovit-morozhenoe-doma", "true_category": "–ï–¥–∞ –∏ –∫—É–ª–∏–Ω–∞—Ä–∏—è"},
    {"url": "https://eda.ru/media/recepty/5-receptov-holodnogo-kofe-dlya-zharkih-dney", "true_category": "–ï–¥–∞ –∏ –∫—É–ª–∏–Ω–∞—Ä–∏—è"},
    {"url": "https://bonduelle.ru/blog/kukhnya-potomkov-vikingov.html", "true_category": "–ï–¥–∞ –∏ –∫—É–ª–∏–Ω–∞—Ä–∏—è"},
    {"url": "https://food.ru/recipes/253989-ruletiki-iz-baklazhanov-po-gruzinski", "true_category": "–ï–¥–∞ –∏ –∫—É–ª–∏–Ω–∞—Ä–∏—è"},
    {"url": "https://povar.ru/art/sbalansirovannoe_meniu_dlya_semi_na_rabochuiu_nedeliu_prosto_nedorogo_bystro.html", "true_category": "–ï–¥–∞ –∏ –∫—É–ª–∏–Ω–∞—Ä–∏—è"},

    {"url": "https://lenta.ru/articles/2023/07/24/lausanne_treaty/", "true_category": "–ò—Å—Ç–æ—Ä–∏—è"},
    {"url": "https://www.trtrussian.com/mnenie/bitva-pri-chanakkale-rozhdenie-nacii-4995603", "true_category": "–ò—Å—Ç–æ—Ä–∏—è"},
    {"url": "https://research-journal.org/archive/4-154-2025-april/10.60797/IRJ.2025.154.107", "true_category": "–ò—Å—Ç–æ—Ä–∏—è"},
    {"url": "https://naked-science.ru/article/column/migratsii-narodov-zapadno", "true_category": "–ò—Å—Ç–æ—Ä–∏—è"},
    {"url": "https://naked-science.ru/article/history/medieval-woman-warrior", "true_category": "–ò—Å—Ç–æ—Ä–∏—è"},
    {"url": "https://naked-science.ru/article/history/voluntary-enslavement", "true_category": "–ò—Å—Ç–æ—Ä–∏—è"},

    {"url": "https://www.iso.org/ru/artificial-intelligence", "true_category": "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç"},
    {"url": "https://www.rbc.ru/technology_and_media/20/05/2025/682c49f09a794714344f7dff", "true_category": "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç"},
    {"url": "https://webiomed.ru/blog/investitsii-v-generativnyi-ii-chto-stoit-za-etoi-gonkoi/", "true_category": "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç"},
    {"url": "https://www.tadviser.ru/index.php/%D0%A1%D1%82%D0%B0%D1%82%D1%8C%D1%8F:%D0%A1%D1%82%D0%B0%D0%BD%D0%B4%D0%B0%D1%80%D1%82%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F_%D0%B8%D1%81%D0%BA%D1%83%D1%81%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D0%BE%D0%B3%D0%BE_%D0%B8%D0%BD%D1%82%D0%B5%D0%BB%D0%BB%D0%B5%D0%BA%D1%82%D0%B0", "true_category": "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç"},
    {"url": "https://practicum.yandex.ru/blog/chto-takoe-iskusstvennyi-intellekt/", "true_category": "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç"},
    {"url": "https://smapse.ru/poprobovali-chatgpt-kak-zamenu-repetitoru-opyt-i-vyvody/", "true_category": "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç"},

    {"url": "https://sci-article.ru/stat.php?i=1721588312", "true_category": "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ"},
    {"url": "https://sibac.info/studconf/hum/cli/379832", "true_category": "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ"},
    {"url": "https://practicum.yandex.ru/blog/neyroset-yandexgpt-kak-polzovatsya/", "true_category": "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ"},
    {"url": "https://daily.afisha.ru/culture/28995-kak-vybrat-luchshuyu-shkolu-dlya-rebenka-razbiraemsya-vmeste-s-ekspertom/", "true_category": "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ"},
    {"url": "https://www.vokrugsveta.ru/vs/article/1799/", "true_category": "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ"},
    {"url": "https://www.hse.ru/news/science/68185068.html", "true_category": "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ"},

    {"url": "https://gabestore.ru/blog/istoriya-stanovleniya-steam?My7J3d59UDbdtPVISlqhjrK4QAoHRGtZwagw6gOYKukwJONuvI7vmyF82XHTaupSC7OLgdXep9DYtNZS8tIPDnStv1sTTellrfp0RqYcbqRA1kn5C4MEGnxI&utm_source=admitad&tagtag_uid=2eece7bd256d3be0363a7cdd4fb02171&uid=2eece7bd256d3be0363a7cdd4fb02171", "true_category": "–í–∏–¥–µ–æ–∏–≥—Ä—ã"},
    {"url": "https://www.rbc.ru/life/news/684938de9a7947684b043bc3", "true_category": "–í–∏–¥–µ–æ–∏–≥—Ä—ã"},
    {"url": "https://stopgame.ru/show/145910/samye_interesnye_relizy_maya", "true_category": "–í–∏–¥–µ–æ–∏–≥—Ä—ã"},
    {"url": "https://stopgame.ru/newsdata/67345/sandfall_izuchaet_varianty_dlya_buduschih_kontentnyh_apdeytov_clair_obscur_expedition_33", "true_category": "–í–∏–¥–µ–æ–∏–≥—Ä—ã"},
    {"url": "https://stopgame.ru/show/143626/horoshie_igry_kotorye_vy_mogli_propustit_v_fevrale", "true_category": "–í–∏–¥–µ–æ–∏–≥—Ä—ã"},
    {"url": "https://stopgame.ru/newsdata/67159/koop_horror_phasmophobia_prevratyat_v_kino_silami_studii_blumhouse", "true_category": "–í–∏–¥–µ–æ–∏–≥—Ä—ã"}
]

# –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≥–æ–Ω–∞ –ø–æ –¥–∞—Ç–∞—Å–µ—Ç—É. –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ —Å–æ–≤–ø–∞–ª–∞ —Å –ø–µ—Ä–≤–æ–π ( —Å–∞–º–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–π ) –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π , –ø—Ä–æ–≤–µ—Ä–∏—Ç—å , –µ—Å—Ç—å –ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –≤–æ –≤—Ç–æ—Ä–æ–π –∏–ª–∏ —Ç—Ä–µ—Ç—å–µ–π –ø–æ–∑–∏—Ü–∏–∏ , –µ—Å–ª–∏ –∏ —Ç–∞–º –Ω–µ—Ç ‚Äî –∑–Ω–∞—á–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ—Ç –≤ —Ç–æ–ø-3.
def test_classifier_on_dataset(dataset):
    results = []

    for entry in dataset:
        url = entry["url"]
        true_cat = entry["true_category"]
        print(f"–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é: {url} (–æ–∂–∏–¥–∞–µ—Ç—Å—è: {true_cat})")

        result = analyze_article(url)

        if "error" in result:
            print(f"–û—à–∏–±–∫–∞: {result['error']}")
            predicted = None
            true_pos = "4+"
        else:
            preds = [c["category"] for c in result.get("categories", [])[:3]]

            if true_cat in preds:
                true_pos = preds.index(true_cat) + 1  # 1 , 2 –∏–ª–∏ 3.
            else:
                true_pos = "4+"

            predicted = preds[0] if preds else None

        correct = (true_pos == 1)

        results.append({
            "URL": url,
            "–û–∂–∏–¥–∞–µ–º–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è": true_cat,
            "–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è": predicted,
            "–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ": "–î–∞" if correct else "–ù–µ—Ç",
            "–ü–æ–∑–∏—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Ç–æ–ø-3": true_pos
        })

    df = pd.DataFrame(results)

    print("\nüìã –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:")
    print(tabulate(df, headers='keys', tablefmt='grid'))

    # –¢–æ—á–Ω–æ—Å—Ç—å ( –ø–æ–∑–∏—Ü–∏—è 1 ).
    correct_count = df["–°–æ–≤–ø–∞–¥–µ–Ω–∏–µ"].value_counts().get("–î–∞", 0)
    total = len(df)
    accuracy = correct_count / total * 100

    plt.figure(figsize=(6, 4))
    plt.bar(["–°–æ–≤–ø–∞–ª–æ", "–ù–µ —Å–æ–≤–ø–∞–ª–æ"], [correct_count, total - correct_count], color=["green", "red"])
    plt.title(f"–¢–æ—á–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–ø–æ–∑–∏—Ü–∏—è 1): {accuracy:.1f}%")
    plt.ylabel("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞—Ç–µ–π")
    plt.show()

    # –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –≤—Å–µ—Ö ( –≤–∫–ª—é—á–∞—è 1 ).
    # –î–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∑–∞–º–µ–Ω–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞ —á–∏—Å–ª–æ–≤—ã–µ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞.
    order_map = {1: 1, 2: 2, 3: 3, "4+": 4}
    pos_counts = df["–ü–æ–∑–∏—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Ç–æ–ø-3"].value_counts()
    pos_counts = pos_counts.reindex(sorted(pos_counts.index, key=lambda x: order_map[x]))

    # –ü–æ–¥—Å—á—ë—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤.
    pos_percent = (pos_counts / total * 100).round(1)

    plt.figure(figsize=(7, 4))

    # –ì—Ä–∞–¥–∏–µ–Ω—Ç –∂—ë–ª—Ç—ã—Ö —Ü–≤–µ—Ç–æ–≤ –æ—Ç gold –¥–æ khaki.
    base_color = np.array(mcolors.to_rgb("khaki"))
    light_color = np.array(mcolors.to_rgb("gold"))

    n = len(pos_percent)
    colors = [base_color + (light_color - base_color) * i/(n-1) for i in range(n)]
    colors = [mcolors.to_hex(c) for c in colors]

    bars = plt.bar(pos_percent.index.astype(str), pos_percent.values, color=colors)

    # –î–æ–±–∞–≤–∏–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã –Ω–∞–¥ —Å—Ç–æ–ª–±–∏–∫–∞–º–∏.
    for bar, pct in zip(bars, pos_percent.values):
        plt.text(bar.get_x() + bar.get_width()/2, bar.get_height(), f"{pct}%", ha='center', va='bottom')

    plt.xlabel("–ü–æ–∑–∏—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏")
    plt.ylabel("–ü—Ä–æ—Ü–µ–Ω—Ç —Å—Ç–∞—Ç–µ–π (%)")
    plt.title("–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ –ø–æ–∑–∏—Ü–∏—è–º (1, 2, 3, 4+)")
    plt.ylim(0, max(pos_percent.values)*1.2)
    plt.show()

    return df

# –î–∏–∞–≥—Ä–∞–º–º–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞ –ø—Ä–æ–≥–æ–Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞.
df_result = test_classifier_on_dataset(test_dataset)

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
# –†–µ–∑—É–ª—å—Ç–∞—Ç. –ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
  # –°—Å—ã–ª–∫—É ;
  # –ó–∞–≥–æ–ª–æ–≤–æ–∫ ;
  # –ò—Å—Ç–æ—á–Ω–∏–∫ –∏ —Ç–∏–ø ;
  # –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π ;
  # –û—Ü–µ–Ω–∫—É.
# –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
url_input = widgets.Text(
    placeholder='–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Å—Ç–∞—Ç—å—é',
    description='–°—Å—ã–ª–∫–∞:',
    layout=widgets.Layout(width='90%')
)
analyze_button = widgets.Button(description="–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å", button_style='success')
stop_button = widgets.Button(description="–°—Ç–æ–ø", button_style='danger')
output = widgets.Output()

# –§–ª–∞–≥ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.
stop_flag = {"value": False}

def on_analyze_clicked(b):
    if stop_flag["value"]:
        with output:
            clear_output()
            print("–ê–Ω–∞–ª–∏–∑ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.")
        return

    url = url_input.value.strip()
    if not url:
        with output:
            clear_output()
            print("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É.")
        return

    result = analyze_article(url)

    with output:
        print("=" * 60)
        if "error" in result:
            print("–û—à–∏–±–∫–∞:", result["error"])
        else:
            table = [
                ["–°—Å—ã–ª–∫–∞", result["url"]],
                ["–ó–∞–≥–æ–ª–æ–≤–æ–∫", result["title"]],
                ["–ò—Å—Ç–æ—á–Ω–∏–∫", result["source"]],
                ["–¢–∏–ø –∏—Å—Ç–æ—á–Ω–∏–∫–∞", result["source_type"]],
                ["–ö–∞—Ç–µ–≥–æ—Ä–∏–∏", ", ".join([f"{cat['category']} {cat['percent']}%" for cat in result["categories"]])],
                ["–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞", result["score"]],
            ]
            print(tabulate(table, tablefmt="grid"))
        url_input.value = ''  # –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞.

def on_stop_clicked(b):
    stop_flag["value"] = True
    with output:
        clear_output()
        print("–†–∞–±–æ—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞. –ë–æ–ª—å—à–µ –∞–Ω–∞–ª–∏–∑ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è.")

# –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –∫–Ω–æ–ø–∫–∞–º.
analyze_button.on_click(on_analyze_clicked)
stop_button.on_click(on_stop_clicked)

# –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
display(widgets.VBox([
    url_input,
    widgets.HBox([analyze_button, stop_button]),
    output
]))

"""# **–ü–ª–∞–Ω –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ ML-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å TF-IDF:**


---


**1. –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç–∞—Å–µ—Ç:**

–ù—É–∂–Ω—ã –ø—Ä–∏–º–µ—Ä—ã —Ç–µ–∫—Å—Ç–æ–≤ —Å –º–µ—Ç–∫–∞–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π ‚Äî —á—Ç–æ–±—ã –º–æ–¥–µ–ª—å –Ω–∞—É—á–∏–ª–∞—Å—å –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å. –ú–æ–∂–Ω–æ –≤–∑—è—Ç—å —Å—Ç–∞—Ç—å–∏ , –≥–¥–µ –∏–∑–≤–µ—Å—Ç–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è ( –Ω–∞–ø—Ä–∏–º–µ—Ä , —Å–æ–±–∏—Ä–∞—Ç—å –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏–ª–∏ –≤—Ä—É—á–Ω—É—é —Ä–∞–∑–º–µ—á–∞—Ç—å ).

–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö:

–¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏ | –ö–∞—Ç–µ–≥–æ—Ä–∏—è

"–ü—Ä–µ–∑–∏–¥–µ–Ω—Ç –ø–æ–¥–ø–∏—Å–∞–ª –Ω–æ–≤—ã–π –∑–∞–∫–æ–Ω..."	–ü–æ–ª–∏—Ç–∏–∫–∞
"–ù–æ–≤—ã–π —Å–º–∞—Ä—Ç—Ñ–æ–Ω —Å –∏–Ω–Ω–æ–≤–∞—Ü–∏–æ–Ω–Ω—ã–º..."	IT –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã
"–ú–∏—Ä–æ–≤–æ–π —Ä—ã–Ω–æ–∫ –∞–∫—Ü–∏–π —É–ø–∞–ª..."	–≠–∫–æ–Ω–æ–º–∏–∫–∞


---


**2. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ:**

- –¢–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è –∏ –ª–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è ( –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ )

- –£–±—Ä–∞—Ç—å —Å—Ç–æ–ø-—Å–ª–æ–≤–∞

- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç—ã –≤ —á–∏—Å–ª–æ–≤—ã–µ –≤–µ–∫—Ç–æ—Ä—ã —Å –ø–æ–º–æ—â—å—é TF-IDF
---
**3. –û–±—É—á–∏—Ç—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä:**

–ü—Ä–∏–º–µ—Ä: –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥—Ä–µ—Å—Å–∏—è –∏–ª–∏ —Å–ª—É—á–∞–π–Ω—ã–π –ª–µ—Å.
–ò—Å–ø–æ–ª—å–∑—É–µ–º sklearn.
"""